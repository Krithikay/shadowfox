<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-commerce Store - Enhanced UX</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="ecommerce.js"></script>
    <style>
   
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #334155; 
        }
     
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
       
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;  
            scrollbar-width: none;  
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header -->
    <header class="bg-white shadow-md py-4 sticky top-0 z-20">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <a href="#" class="text-3xl font-extrabold text-indigo-700 hover:text-indigo-800 transition duration-300">Shopisy</a>
            <nav class="flex items-center space-x-6">
                <a href="#" class="text-gray-600 hover:text-indigo-700 font-medium transition duration-300">Home</a>
                <a href="#" class="text-gray-600 hover:text-indigo-700 font-medium transition duration-300">Shop</a>
                <a href="#" class="text-gray-600 hover:text-indigo-700 font-medium transition duration-300">About</a>
                <a href="#" class="text-gray-600 hover:text-indigo-700 font-medium transition duration-300">Contact</a>
                <button id="cart-button" class="relative p-2 rounded-full bg-indigo-100 text-indigo-700 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition duration-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    <span id="cart-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="container mx-auto px-4 py-8 flex flex-col lg:flex-row gap-8">

        <!-- Sidebar for Filters -->
        <aside class="lg:w-1/4 bg-white p-6 rounded-lg shadow-lg h-fit sticky top-24">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Filters</h2>

            <!-- Category Filter -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">Category</h3>
                <div class="space-y-2">
                    <label class="flex items-center text-gray-600">
                        <input type="checkbox" name="category" value="Electronics" class="form-checkbox h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500 mr-2"> Electronics
                    </label>
                    <label class="flex items-center text-gray-600">
                        <input type="checkbox" name="category" value="Apparel" class="form-checkbox h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500 mr-2"> Apparel
                    </label>
                    <label class="flex items-center text-gray-600">
                        <input type="checkbox" name="category" value="Books" class="form-checkbox h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500 mr-2"> Books
                    </label>
                    <label class="flex items-center text-gray-600">
                        <input type="checkbox" name="category" value="Home & Kitchen" class="form-checkbox h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500 mr-2"> Home & Kitchen
                    </label>
                </div>
            </div>

            <!-- Price Range Filter -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">Price Range</h3>
                <div class="space-y-2">
                    <label class="flex items-center text-gray-600">
                        <input type="radio" name="price" value="0-50" class="form-radio h-4 w-4 text-indigo-600 focus:ring-indigo-500 mr-2"> Under $50
                    </label>
                    <label class="flex items-center text-gray-600">
                        <input type="radio" name="price" value="50-100" class="form-radio h-4 w-4 text-indigo-600 focus:ring-indigo-500 mr-2"> $50 - $100
                    </label>
                    <label class="flex items-center text-gray-600">
                        <input type="radio" name="price" value="100-200" class="form-radio h-4 w-4 text-indigo-600 focus:ring-indigo-500 mr-2"> $100 - $200
                    </label>
                    <label class="flex items-center text-gray-600">
                        <input type="radio" name="price" value="200-max" class="form-radio h-4 w-4 text-indigo-600 focus:ring-indigo-500 mr-2"> Over $200
                    </label>
                    <label class="flex items-center text-gray-600">
                        <input type="radio" name="price" value="all" class="form-radio h-4 w-4 text-indigo-600 focus:ring-indigo-500 mr-2" checked> All Prices
                    </label>
                </div>
            </div>

            <!-- Brand Filter -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">Brand</h3>
                <div class="space-y-2 max-h-40 overflow-y-auto hide-scrollbar">
                    <label class="flex items-center text-gray-600">
                        <input type="checkbox" name="brand" value="Brand A" class="form-checkbox h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500 mr-2"> Brand A
                    </label>
                    <label class="flex items-center text-gray-600">
                        <input type="checkbox" name="brand" value="Brand B" class="form-checkbox h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500 mr-2"> Brand B
                    </label>
                    <label class="flex items-center text-gray-600">
                        <input type="checkbox" name="brand" value="Brand C" class="form-checkbox h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500 mr-2"> Brand C
                    </label>
                    <label class="flex items-center text-gray-600">
                        <input type="checkbox" name="brand" value="Brand D" class="form-checkbox h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500 mr-2"> Brand D
                    </label>
                    <label class="flex items-center text-gray-600">
                        <input type="checkbox" name="brand" value="Brand E" class="form-checkbox h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500 mr-2"> Brand E
                    </label>
                </div>
            </div>

            <!-- Availability Filter -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">Availability</h3>
                <label class="flex items-center text-gray-600">
                    <input type="checkbox" name="availability" value="In Stock" class="form-checkbox h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500 mr-2"> In Stock
                </label>
            </div>

            <button id="apply-filters-btn" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition duration-300">Apply Filters</button>
            <button id="clear-filters-btn" class="w-full mt-2 bg-gray-200 text-gray-800 py-2 px-4 rounded-md font-semibold hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition duration-300">Clear Filters</button>
        </aside>

        <!-- Product Listing Area -->
        <section class="flex-1">
            <div class="flex justify-between items-center mb-6 bg-white p-4 rounded-lg shadow-sm">
                <h1 class="text-2xl font-bold text-gray-800">All Products</h1>
                <div class="flex items-center space-x-4">
                    <label for="sort-by" class="text-gray-700 font-medium">Sort by:</label>
                    <select id="sort-by" class="block w-48 py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option value="default">Featured</option>
                        <option value="price-asc">Price: Low to High</option>
                        <option value="price-desc">Price: High to Low</option>
                        <option value="name-asc">Name: A-Z</option>
                        <option value="name-desc">Name: Z-A</option>
                        <option value="popularity">Popularity</option>
                    </select>
                </div>
            </div>

            <!-- Product Grid -->
            <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Product cards will be dynamically loaded here by JavaScript -->
            </div>

            <!-- No Products Found Message -->
            <div id="no-products-message" class="hidden text-center text-gray-600 text-xl py-10">
                No products found matching your criteria.
            </div>
        </section>
    </main>

    <!-- Shopping Cart Modal -->
    <div id="cart-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6 relative transform transition-all sm:my-8 sm:w-full sm:max-w-lg">
            <button id="close-cart-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-4">Your Shopping Cart</h2>

            <div id="cart-items-container" class="max-h-96 overflow-y-auto hide-scrollbar mb-6 pr-2">
                <!-- Cart items will be dynamically loaded here -->
                <div id="empty-cart-message" class="text-center text-gray-500 py-10 hidden">Your cart is empty.</div>
            </div>

            <div class="border-t pt-4">
                <div class="flex justify-between items-center text-lg font-semibold text-gray-800 mb-2">
                    <span>Subtotal:</span>
                    <span id="cart-subtotal">$0.00</span>
                </div>
                <div class="flex justify-between items-center text-sm text-gray-600 mb-4">
                    <span>Shipping & Tax calculated at checkout.</span>
                </div>
                <button id="proceed-to-checkout-btn" class="w-full bg-indigo-600 text-white py-3 px-4 rounded-md font-semibold text-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition duration-300">Proceed to Checkout</button>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkout-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl p-8 relative transform transition-all sm:my-8 sm:w-full sm:max-w-2xl">
            <button id="close-checkout-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-4">Checkout</h2>

            <!-- Checkout Steps Indicator -->
            <div class="flex justify-between mb-8 text-center">
                <div class="flex-1">
                    <div id="step-1-indicator" class="w-10 h-10 mx-auto rounded-full bg-indigo-600 text-white flex items-center justify-center font-bold mb-2">1</div>
                    <span class="text-sm font-medium text-gray-700">Shipping</span>
                </div>
                <div class="flex-1 relative">
                    <div class="absolute inset-y-0 left-0 w-full h-1 bg-gray-300 top-5 -z-10"></div>
                    <div id="step-2-indicator" class="w-10 h-10 mx-auto rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold mb-2">2</div>
                    <span class="text-sm font-medium text-gray-700">Payment</span>
                </div>
                <div class="flex-1 relative">
                    <div class="absolute inset-y-0 left-0 w-full h-1 bg-gray-300 top-5 -z-10"></div>
                    <div id="step-3-indicator" class="w-10 h-10 mx-auto rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold mb-2">3</div>
                    <span class="text-sm font-medium text-gray-700">Review</span>
                </div>
            </div>

            <!-- Checkout Form -->
            <form id="checkout-form" class="space-y-6">
                <!-- Step 1: Shipping Information -->
                <div id="shipping-step" class="checkout-step">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Shipping Information</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="fullName" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                            <input type="text" id="fullName" name="fullName" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
                        </div>
                        <div>
                            <label for="emailCheckout" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" id="emailCheckout" name="emailCheckout" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
                        </div>
                        <div class="md:col-span-2">
                            <label for="address" class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                            <input type="text" id="address" name="address" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
                        </div>
                        <div>
                            <label for="city" class="block text-sm font-medium text-gray-700 mb-1">City</label>
                            <input type="text" id="city" name="city" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
                        </div>
                        <div>
                            <label for="zip" class="block text-sm font-medium text-gray-700 mb-1">ZIP Code</label>
                            <input type="text" id="zip" name="zip" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" required>
                        </div>
                    </div>
                    <button type="button" id="next-to-payment-btn" class="mt-8 w-full bg-indigo-600 text-white py-3 px-4 rounded-md font-semibold text-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition duration-300">Next: Payment</button>
                </div>

                <!-- Step 2: Payment Information -->
                <div id="payment-step" class="checkout-step hidden">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Payment Information</h3>
                    <div class="space-y-4">
                        <div>
                            <label for="cardNumber" class="block text-sm font-medium text-gray-700 mb-1">Card Number</label>
                            <input type="text" id="cardNumber" name="cardNumber" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="XXXX XXXX XXXX XXXX" required>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="expiryDate" class="block text-sm font-medium text-gray-700 mb-1">Expiry Date (MM/YY)</label>
                                <input type="text" id="expiryDate" name="expiryDate" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="MM/YY" required>
                            </div>
                            <div>
                                <label for="cvv" class="block text-sm font-medium text-gray-700 mb-1">CVV</label>
                                <input type="text" id="cvv" name="cvv" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="XXX" required>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-between mt-8">
                        <button type="button" id="prev-to-shipping-btn" class="bg-gray-200 text-gray-800 py-3 px-6 rounded-md font-semibold hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition duration-300">Previous</button>
                        <button type="button" id="next-to-review-btn" class="bg-indigo-600 text-white py-3 px-6 rounded-md font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition duration-300">Next: Review</button>
                    </div>
                </div>

                <!-- Step 3: Order Review -->
                <div id="review-step" class="checkout-step hidden">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">Order Review</h3>
                    <div class="bg-gray-50 p-6 rounded-lg shadow-inner mb-6">
                        <h4 class="text-xl font-semibold text-gray-800 mb-3">Shipping Details:</h4>
                        <p id="review-shipping-details" class="text-gray-700 mb-4"></p>

                        <h4 class="text-xl font-semibold text-gray-800 mb-3">Order Summary:</h4>
                        <div id="review-order-summary" class="space-y-2 text-gray-700">
                            <!-- Order items will be dynamically loaded here -->
                        </div>
                        <div class="border-t pt-4 mt-4 text-lg font-bold text-gray-800 flex justify-between">
                            <span>Total (incl. Shipping & Tax):</span>
                            <span id="review-total">$0.00</span>
                        </div>
                    </div>
                    <div class="flex justify-between mt-8">
                        <button type="button" id="prev-to-payment-btn" class="bg-gray-200 text-gray-800 py-3 px-6 rounded-md font-semibold hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition duration-300">Previous</button>
                        <button type="submit" id="place-order-btn" class="bg-green-600 text-white py-3 px-6 rounded-md font-semibold text-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition duration-300">Place Order</button>
                    </div>
                </div>
            </form>

            <!-- Order Confirmation Message (after successful order) -->
            <div id="order-confirmation" class="hidden text-center py-10">
                <svg class="mx-auto h-20 w-20 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <h3 class="text-3xl font-bold text-gray-800 mb-4">Order Placed Successfully!</h3>
                <p class="text-lg text-gray-700">Thank you for your purchase. Your order #<span id="order-id"></span> has been confirmed and will be shipped soon.</p>
                <button id="continue-shopping-btn" class="mt-8 bg-indigo-600 text-white py-3 px-6 rounded-md font-semibold hover:bg-indigo-700 transition duration-300">Continue Shopping</button>
            </div>
        </div>
    </div>

    <!-- Message Box for Alerts (instead of alert()) -->
    <div id="message-box" class="fixed bottom-4 right-4 bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg hidden z-50 transition-all duration-300 transform translate-y-full opacity-0">
        <span id="message-text"></span>
        <button class="ml-4 font-bold" onclick="document.getElementById('message-box').classList.add('hidden', 'translate-y-full', 'opacity-0'); document.getElementById('message-box').classList.remove('flex', 'translate-y-0', 'opacity-100');">&times;</button>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 px-4 mt-12">
        <div class="container mx-auto text-center">
            <p>&copy; 2025 ShopNow. All rights reserved.</p>
            <div class="flex justify-center space-x-6 mt-4">
                <a href="#" class="text-gray-400 hover:text-white transition duration-300">Privacy Policy</a>
                <a href="#" class="text-gray-400 hover:text-white transition duration-300">Terms of Service</a>
            </div>
        </div>
    </footer>

    <script>
        
        function showMessageBox(message, type = 'info') {
            const msgBox = document.getElementById('message-box');
            const msgText = document.getElementById('message-text');

            msgText.textContent = message;
            msgBox.classList.remove('bg-red-600', 'bg-green-600', 'bg-blue-600', 'hidden', 'translate-y-full', 'opacity-0');
            msgBox.classList.add('flex', 'translate-y-0', 'opacity-100');

            if (type === 'error') {
                msgBox.classList.add('bg-red-600');
            } else if (type === 'success') {
                msgBox.classList.add('bg-green-600');
            } else {
                msgBox.classList.add('bg-blue-600');
            }

            setTimeout(() => {
                msgBox.classList.add('hidden', 'translate-y-full', 'opacity-0');
                msgBox.classList.remove('flex', 'translate-y-0', 'opacity-100');
            }, 3000); 
        }

        
        const allProducts = [
            { id: 1, name: 'Wireless Headphones', category: 'Electronics', price: 79.99, brand: 'Brand A', imageUrl: 'https://placehold.co/400x300/a78bfa/ffffff?text=Headphones', inStock: true, popularity: 120 },
            { id: 2, name: 'Smartwatch Pro', category: 'Electronics', price: 199.99, brand: 'Brand B', imageUrl: 'https://placehold.co/400x300/818cf8/ffffff?text=Smartwatch', inStock: true, popularity: 150 },
            { id: 3, name: 'Classic T-Shirt', category: 'Apparel', price: 24.99, brand: 'Brand C', imageUrl: 'https://placehold.co/400x300/c4b5fd/ffffff?text=T-Shirt', inStock: true, popularity: 80 },
            { id: 4, name: 'Gaming Laptop', category: 'Electronics', price: 1200.00, brand: 'Brand A', imageUrl: 'https://placehold.co/400x300/6366f1/ffffff?text=Laptop', inStock: false, popularity: 90 },
            { id: 5, name: 'Fiction Novel', category: 'Books', price: 15.50, brand: 'Brand D', imageUrl: 'https://placehold.co/400x300/4f46e5/ffffff?text=Book', inStock: true, popularity: 200 },
            { id: 6, name: 'Coffee Maker', category: 'Home & Kitchen', price: 89.00, brand: 'Brand E', imageUrl: 'https://placehold.co/400x300/4338ca/ffffff?text=Coffee+Maker', inStock: true, popularity: 110 },
            { id: 7, name: 'Bluetooth Speaker', category: 'Electronics', price: 45.00, brand: 'Brand C', imageUrl: 'https://placehold.co/400x300/3730a3/ffffff?text=Speaker', inStock: true, popularity: 70 },
            { id: 8, name: 'Winter Jacket', category: 'Apparel', price: 110.00, brand: 'Brand B', imageUrl: 'https://placehold.co/400x300/312e81/ffffff?text=Jacket', inStock: true, popularity: 60 },
            { id: 9, name: 'Cookbook', category: 'Books', price: 29.99, brand: 'Brand D', imageUrl: 'https://placehold.co/400x300/2a247c/ffffff?text=Cookbook', inStock: true, popularity: 180 },
            { id: 10, name: 'Blender Pro', category: 'Home & Kitchen', price: 150.00, brand: 'Brand E', imageUrl: 'https://placehold.co/400x300/231e6b/ffffff?text=Blender', inStock: true, popularity: 95 },
        ];

        let filteredProducts = [...allProducts];
        let cart = [];

        
        const productGrid = document.getElementById('product-grid');
        const cartCount = document.getElementById('cart-count');
        const cartModal = document.getElementById('cart-modal');
        const cartButton = document.getElementById('cart-button');
        const closeCartModal = document.getElementById('close-cart-modal');
        const cartItemsContainer = document.getElementById('cart-items-container');
        const cartSubtotal = document.getElementById('cart-subtotal');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const proceedToCheckoutBtn = document.getElementById('proceed-to-checkout-btn');

        const checkoutModal = document.getElementById('checkout-modal');
        const closeCheckoutModal = document.getElementById('close-checkout-modal');
        const checkoutForm = document.getElementById('checkout-form');
        const shippingStep = document.getElementById('shipping-step');
        const paymentStep = document.getElementById('payment-step');
        const reviewStep = document.getElementById('review-step');
        const nextToPaymentBtn = document.getElementById('next-to-payment-btn');
        const prevToShippingBtn = document.getElementById('prev-to-shipping-btn');
        const nextToReviewBtn = document.getElementById('next-to-review-btn');
        const prevToPaymentBtn = document.getElementById('prev-to-payment-btn');
        const placeOrderBtn = document.getElementById('place-order-btn');
        const orderConfirmation = document.getElementById('order-confirmation');
        const orderIdSpan = document.getElementById('order-id');
        const continueShoppingBtn = document.getElementById('continue-shopping-btn');
        const noProductsMessage = document.getElementById('no-products-message');

        const step1Indicator = document.getElementById('step-1-indicator');
        const step2Indicator = document.getElementById('step-2-indicator');
        const step3Indicator = document.getElementById('step-3-indicator');

        let currentCheckoutStep = 1;

       
        function renderProducts(productsToRender) {
            productGrid.innerHTML = '';
            if (productsToRender.length === 0) {
                noProductsMessage.classList.remove('hidden');
            } else {
                noProductsMessage.classList.add('hidden');
                productsToRender.forEach(product => {
                    const productCard = `
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden transform hover:scale-105 transition duration-300">
                            <img src="${product.imageUrl}" alt="${product.name}" class="w-full h-48 object-cover">
                            <div class="p-5">
                                <h3 class="text-xl font-semibold text-gray-800 mb-2">${product.name}</h3>
                                <p class="text-gray-600 text-sm mb-3">${product.category} | ${product.brand}</p>
                                <div class="flex justify-between items-center mb-4">
                                    <span class="text-2xl font-bold text-indigo-700">$${product.price.toFixed(2)}</span>
                                    ${product.inStock ? '<span class="text-green-600 text-sm font-medium">In Stock</span>' : '<span class="text-red-600 text-sm font-medium">Out of Stock</span>'}
                                </div>
                                <button data-product-id="${product.id}" class="add-to-cart-btn w-full bg-indigo-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition duration-300 ${!product.inStock ? 'opacity-50 cursor-not-allowed' : ''}" ${!product.inStock ? 'disabled' : ''}>
                                    Add to Cart
                                </button>
                            </div>
                        </div>
                    `;
                    productGrid.insertAdjacentHTML('beforeend', productCard);
                });
            }
        }

       
        function applyFiltersAndSort() {
            let currentProducts = [...allProducts];

          
            const selectedCategories = Array.from(document.querySelectorAll('input[name="category"]:checked')).map(cb => cb.value);
            const selectedPriceRange = document.querySelector('input[name="price"]:checked').value;
            const selectedBrands = Array.from(document.querySelectorAll('input[name="brand"]:checked')).map(cb => cb.value);
            const inStockOnly = document.querySelector('input[name="availability"]:checked') ? true : false;

            currentProducts = currentProducts.filter(product => {
                let categoryMatch = selectedCategories.length === 0 || selectedCategories.includes(product.category);
                let brandMatch = selectedBrands.length === 0 || selectedBrands.includes(product.brand);
                let stockMatch = !inStockOnly || product.inStock;

                let priceMatch = true;
                if (selectedPriceRange !== 'all') {
                    const [min, max] = selectedPriceRange.split('-').map(Number);
                    if (selectedPriceRange === '200-max') {
                        priceMatch = product.price >= min;
                    } else {
                        priceMatch = product.price >= min && product.price <= max;
                    }
                }
                return categoryMatch && brandMatch && stockMatch && priceMatch;
            });

            
            const sortBy = document.getElementById('sort-by').value;
            switch (sortBy) {
                case 'price-asc':
                    currentProducts.sort((a, b) => a.price - b.price);
                    break;
                case 'price-desc':
                    currentProducts.sort((a, b) => b.price - a.price);
                    break;
                case 'name-asc':
                    currentProducts.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'name-desc':
                    currentProducts.sort((a, b) => b.name.localeCompare(a.name));
                    break;
                case 'popularity':
                    currentProducts.sort((a, b) => b.popularity - a.popularity);
                    break;
                case 'default':
                default:
                  
                    break;
            }

            filteredProducts = currentProducts; 
            renderProducts(filteredProducts);
        }

        
        function addToCart(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;

            const existingItem = cart.find(item => item.id === productId);

            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            updateCartDisplay();
            showMessageBox(`${product.name} added to cart!`, 'success');
        }

       
        function updateCartQuantity(productId, newQuantity) {
            const itemIndex = cart.findIndex(item => item.id === productId);
            if (itemIndex > -1) {
                if (newQuantity > 0) {
                    cart[itemIndex].quantity = newQuantity;
                } else {
                    cart.splice(itemIndex, 1); 
                }
                updateCartDisplay();
            }
        }

       
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartDisplay();
            showMessageBox('Item removed from cart.', 'info');
        }

        
        function renderCartItems() {
            cartItemsContainer.innerHTML = '';
            if (cart.length === 0) {
                emptyCartMessage.classList.remove('hidden');
            } else {
                emptyCartMessage.classList.add('hidden');
                cart.forEach(item => {
                    const cartItemHtml = `
                        <div class="flex items-center justify-between py-3 border-b border-gray-200 last:border-b-0">
                            <div class="flex items-center">
                                <img src="${item.imageUrl}" alt="${item.name}" class="w-16 h-16 rounded-md object-cover mr-4">
                                <div>
                                    <h4 class="text-lg font-medium text-gray-800">${item.name}</h4>
                                    <p class="text-gray-600 text-sm">$${item.price.toFixed(2)} each</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="flex items-center border border-gray-300 rounded-md">
                                    <button data-id="${item.id}" data-action="decrease" class="cart-qty-btn px-3 py-1 text-gray-700 hover:bg-gray-100 rounded-l-md">-</button>
                                    <span class="px-3 py-1 border-x border-gray-300">${item.quantity}</span>
                                    <button data-id="${item.id}" data-action="increase" class="cart-qty-btn px-3 py-1 text-gray-700 hover:bg-gray-100 rounded-r-md">+</button>
                                </div>
                                <button data-id="${item.id}" class="remove-from-cart-btn text-red-500 hover:text-red-700 transition duration-300">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div>
                        </div>
                    `;
                    cartItemsContainer.insertAdjacentHTML('beforeend', cartItemHtml);
                });
            }
        }

       
        function updateCartDisplay() {
            renderCartItems();
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            cartCount.textContent = totalItems;
            cartSubtotal.textContent = `$${subtotal.toFixed(2)}`;

            if (totalItems === 0) {
                proceedToCheckoutBtn.disabled = true;
                proceedToCheckoutBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                proceedToCheckoutBtn.disabled = false;
                proceedToCheckoutBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

       
        function showCheckoutStep(step) {
            currentCheckoutStep = step;
            const steps = [shippingStep, paymentStep, reviewStep];
            const indicators = [step1Indicator, step2Indicator, step3Indicator];

            steps.forEach((s, index) => {
                if (index + 1 === step) {
                    s.classList.remove('hidden');
                } else {
                    s.classList.add('hidden');
                }
            });

            indicators.forEach((ind, index) => {
                if (index + 1 < step) {
                    ind.classList.remove('bg-gray-300', 'text-gray-600');
                    ind.classList.add('bg-green-500', 'text-white');
                } else if (index + 1 === step) {
                    ind.classList.remove('bg-gray-300', 'text-gray-600', 'bg-green-500', 'text-white');
                    ind.classList.add('bg-indigo-600', 'text-white');
                } else {
                    ind.classList.remove('bg-indigo-600', 'text-white', 'bg-green-500', 'text-white');
                    ind.classList.add('bg-gray-300', 'text-gray-600');
                }
            });
        }

       
        function validateStep(stepElement) {
            const inputs = stepElement.querySelectorAll('input[required]');
            let allValid = true;
            inputs.forEach(input => {
                if (!input.value.trim()) {
                    input.classList.add('border-red-500');
                    allValid = false;
                } else {
                    input.classList.remove('border-red-500');
                }
            });
            return allValid;
        }

       
        function populateReviewStep() {
            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('emailCheckout').value;
            const address = document.getElementById('address').value;
            const city = document.getElementById('city').value;
            const zip = document.getElementById('zip').value;

            document.getElementById('review-shipping-details').innerHTML = `
                <p><strong>Name:</strong> ${fullName}</p>
                <p><strong>Email:</strong> ${email}</p>
                <p><strong>Address:</strong> ${address}, ${city}, ${zip}</p>
            `;

            const reviewOrderSummary = document.getElementById('review-order-summary');
            reviewOrderSummary.innerHTML = '';
            let totalAmount = 0;
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                totalAmount += itemTotal;
                reviewOrderSummary.insertAdjacentHTML('beforeend', `
                    <p>${item.name} x ${item.quantity} - $${itemTotal.toFixed(2)}</p>
                `);
            });

            // Simulate shipping and tax
            const shippingCost = 10.00;
            const taxRate = 0.05; // 5%
            const taxAmount = totalAmount * taxRate;
            const finalTotal = totalAmount + shippingCost + taxAmount;

            reviewOrderSummary.insertAdjacentHTML('beforeend', `
                <p class="border-t pt-2 mt-2">Shipping: $${shippingCost.toFixed(2)}</p>
                <p>Tax (5%): $${taxAmount.toFixed(2)}</p>
            `);
            document.getElementById('review-total').textContent = `$${finalTotal.toFixed(2)}`;
        }

        
        document.addEventListener('DOMContentLoaded', () => {
            renderProducts(allProducts);
            updateCartDisplay(); 
        });

        
        document.getElementById('apply-filters-btn').addEventListener('click', applyFiltersAndSort);
        document.getElementById('clear-filters-btn').addEventListener('click', () => {
            document.querySelectorAll('input[name="category"]:checked').forEach(cb => cb.checked = false);
            document.querySelector('input[name="price"][value="all"]').checked = true;
            document.querySelectorAll('input[name="brand"]:checked').forEach(cb => cb.checked = false);
            document.querySelector('input[name="availability"]').checked = false;
            document.getElementById('sort-by').value = 'default'; 
            applyFiltersAndSort(); 
        });

       
        document.getElementById('sort-by').addEventListener('change', applyFiltersAndSort);

        
        productGrid.addEventListener('click', (e) => {
            if (e.target.classList.contains('add-to-cart-btn')) {
                const productId = parseInt(e.target.dataset.productId);
                addToCart(productId);
            }
        });

       
        cartButton.addEventListener('click', () => {
            cartModal.classList.remove('hidden');
            updateCartDisplay(); 
        });

        
        closeCartModal.addEventListener('click', () => {
            cartModal.classList.add('hidden');
        });

        
        cartItemsContainer.addEventListener('click', (e) => {
            const target = e.target;
            if (target.classList.contains('cart-qty-btn')) {
                const productId = parseInt(target.dataset.id);
                const currentQuantityEl = target.parentElement.querySelector('span');
                let currentQuantity = parseInt(currentQuantityEl.textContent);
                const action = target.dataset.action;

                if (action === 'increase') {
                    updateCartQuantity(productId, currentQuantity + 1);
                } else if (action === 'decrease') {
                    updateCartQuantity(productId, currentQuantity - 1);
                }
            } else if (target.classList.contains('remove-from-cart-btn') || target.closest('.remove-from-cart-btn')) {
                const productId = parseInt(target.dataset.id || target.closest('.remove-from-cart-btn').dataset.id);
                removeFromCart(productId);
            }
        });

        
        proceedToCheckoutBtn.addEventListener('click', () => {
            if (cart.length === 0) {
                showMessageBox('Your cart is empty. Please add items before checking out.', 'error');
                return;
            }
            cartModal.classList.add('hidden'); 
            checkoutModal.classList.remove('hidden'); 
            showCheckoutStep(1); 
            orderConfirmation.classList.add('hidden'); 
            checkoutForm.classList.remove('hidden'); 
            checkoutForm.reset(); 
        });

        
        closeCheckoutModal.addEventListener('click', () => {
            checkoutModal.classList.add('hidden');
        });

        
        nextToPaymentBtn.addEventListener('click', () => {
            if (validateStep(shippingStep)) {
                showCheckoutStep(2);
            } else {
                showMessageBox('Please fill in all required shipping details.', 'error');
            }
        });

        prevToShippingBtn.addEventListener('click', () => {
            showCheckoutStep(1);
        });

        nextToReviewBtn.addEventListener('click', () => {
            if (validateStep(paymentStep)) {
                populateReviewStep();
                showCheckoutStep(3);
            } else {
                showMessageBox('Please fill in all required payment details.', 'error');
            }
        });

        prevToPaymentBtn.addEventListener('click', () => {
            showCheckoutStep(2);
        });

        
        checkoutForm.addEventListener('submit', (e) => {
            e.preventDefault();
            if (currentCheckoutStep === 3 && validateStep(reviewStep)) {
               
                const orderId = 'ORD' + Math.floor(Math.random() * 100000);
                orderIdSpan.textContent = orderId;

                checkoutForm.classList.add('hidden');
                orderConfirmation.classList.remove('hidden'); 

                cart = []; 
                updateCartDisplay();
                showMessageBox('Order placed successfully!', 'success');
            } else {
                showMessageBox('Please review your order and fill any missing details.', 'error');
            }
        });

        continueShoppingBtn.addEventListener('click', () => {
            checkoutModal.classList.add('hidden');
           
        });

    </script>
</body>
</html>
